"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9953],{69105:function(e,t,l){l.r(t),l.d(t,{default:function(){return Y}});var n=l(35944),r=l(67294),o=l(42651),a=l(47041),i=l(55078),u=l(60503),s=l(87278),c=l(64954),d=l(65723),h=l(13625),g=l(5152),f=l.n(g),p=l(11163),y=l(48728),m=l(68779),v=l(67814),b=l(91444),_=l(98388),x=l(56559),E=l(28001),Z=l(21702),C=()=>(0,n.BX)("div",{className:"flex h-9 w-full items-center rounded-full p-2",children:[(0,n.tZ)("div",{className:"mr-2 flex h-full items-center bg-white text-neutral-600",children:(0,n.tZ)(v.G,{icon:Z.IJ7,spin:!0})}),(0,n.tZ)("span",{className:"text-neutral-600",children:"Loading... "})]}),w=l(33405),S=l(57909),N=l(95609),k=l(28508),T=l(50502),A=l(73396);let O=f()(()=>l.e(3412).then(l.bind(l,12498)),{loadableGenerated:{webpack:()=>[12498]}});var P=e=>{let{disablePortalForNotebookSelector:t=!1,onSelectSuccess:l}=e,{activeNotebookSlug:o,notebooks:a,fetchNotebooks:i,fetchingNotebooks:u,changeTempEditorData:s,changeActiveNotebook:c,createFirstNotebook:g,creatingFirstNoteboook:f}=(0,r.useContext)(d.$h),{setSplitViewContent:p}=(0,r.useContext)(E.V),{selectedEntitySlugForPDFCopilotFullScreen:Z}=(0,r.useContext)(h.$),{sourceType:P,sourceUrl:L,title:R,elementIdSelector:q,text:I}=(0,r.useContext)(y.Z),{isLoggedIn:G,setAuthType:B}=(0,r.useContext)(x.Vo),M=e=>{null==B||B(e)},[X,H]=(0,r.useState)(!1),[D,U]=(0,r.useState)(!1),V=null==a?void 0:a.find(e=>e.full_slug===o),Y=async e=>{try{U(!0);let t=await (0,A.O)(I,P,L,R,q||null);c(e),p("NOTEBOOK"),s({content:t,showToast:!!Z}),H(!1),null==l||l()}catch(e){console.error("Error while saving to notebook",e)}finally{U(!1)}},F=async()=>{if(!G){M("auth_signup");return}try{U(!0);let e=await (0,A.O)(I,P,L,R,q||null);await g(e),p("NOTEBOOK"),null==l||l()}catch(e){console.error("Error while saving to notebook",e)}finally{U(!1)}},W=async e=>{try{G||M("auth_signup"),await Y(e),(0,T.Z)("NB Note Saved",{sourceType:P,notebook:"Selected"})}catch(e){b.Am.error("Error while saving to notebook")}},j=async e=>{try{await Y(e),(0,T.Z)("NB Note Saved",{sourceType:P,notebook:"Others"}),null==l||l()}catch(e){b.Am.error("Error while saving to notebook")}};if((0,r.useEffect)(()=>{i({})},[]),u)return(0,n.tZ)(C,{});let K=I&&I.length>k.eo?(0,n.BX)(n.HY,{children:["Select ",k.eo," characters or less"]}):null;return(null==a?void 0:a.length)===0?(0,n.tZ)(N.default,{disablePortal:!!K,content:K,children:(0,n.tZ)(w.Z,{color:"light",startIcon:(0,n.tZ)(v.G,{icon:m.FL8,className:"text-neutral-600"}),className:"justify-start text-base font-normal !text-neutral-900",onClick:F,fullWidth:!0,isLoading:f||D,disabled:!!K,children:(0,n.tZ)("span",{children:"Save to notebook"})})}):(0,n.BX)(n.HY,{children:[!!V&&(0,n.tZ)(N.default,{disablePortal:!!K,content:K,children:(0,n.tZ)(w.Z,{color:"light",startIcon:(0,n.tZ)(v.G,{icon:m.FL8,className:"text-neutral-600"}),className:"text-left text-base font-normal !text-neutral-900",onClick:()=>W(V.full_slug),fullWidth:!0,disabled:!!K,isLoading:D,children:(0,n.BX)("span",{className:"line-clamp-2",style:{width:"210px"},children:["Save to ",(0,n.BX)("span",{className:"font-medium",children:["“",V.name,"”"]})]})})}),(0,n.tZ)(S.default,{side:"right",content:(0,n.tZ)(O,{onSelect:j}),open:X,onClose:()=>H(!1),onOpen:()=>H(!0),disablePortal:t,children:(0,n.tZ)("div",{children:(0,n.tZ)(N.default,{disablePortal:!!K,content:K,children:(0,n.tZ)(w.Z,{color:"light",className:(0,_.m6)("justify-start text-base",X?"!bg-neutral-100":""),startIcon:(0,n.tZ)(v.G,{icon:m.Zrf,className:"text-neutral-600"}),endIcon:(0,n.tZ)(v.G,{icon:m._tD,className:"text-neutral-300",size:"sm"}),fullWidth:!0,disabled:!!K,children:(0,n.tZ)("span",{className:"font-normal text-neutral-900",children:"Select a notebook"})})})})})]})},L=l(94630),R=l(39596);let q=f()(()=>l.e(915).then(l.bind(l,96726)),{loadableGenerated:{webpack:()=>[96726]},ssr:!1}),I=f()(()=>l.e(6337).then(l.bind(l,27731)),{loadableGenerated:{webpack:()=>[27731]},ssr:!1}),G=f()(()=>l.e(8387).then(l.bind(l,83052)),{loadableGenerated:{webpack:()=>[83052]},ssr:!1}),B=f()(()=>l.e(8038).then(l.bind(l,44184)),{loadableGenerated:{webpack:()=>[44184]},ssr:!1});var M=e=>{let{errorMessage:t,onOperation:l,selectedText:o,closeTooltip:a}=e,i=(0,p.useRouter)(),{entityFullSlug:u,entityType:c}=(0,r.useContext)(s.C),d=null;if("PAPER"===c&&u)d=(0,R.Y9)(u);else if("RECORD"===c){let e=i.query.collection_slug,t=i.query.record_slug;e&&t&&(d=(0,R.hs)(e,t))}return(0,n.BX)("div",{className:"flex flex-col rounded bg-white p-2 shadow-tooltip",style:{minWidth:"200px"},children:[(0,n.tZ)(q,{onClick:e=>l(e,"EXPLAIN"),errorMessage:t}),(0,n.tZ)(B,{selectedText:o,onClick:e=>l(e,"SUMMARIZE")}),(0,n.tZ)(I,{onClick:e=>l(e,"RELATED_PAPERS")}),(0,n.tZ)(G,{selectedText:o}),(0,n.tZ)("div",{className:"my-2 border-b"}),d&&(0,n.tZ)(y.Z.Provider,{value:{text:(0,L.LK)(o),sourceUrl:d,sourceType:"PAPER"===c?"PAPER_PDF":"RECORD"===c?"RECORD_PDF":null},children:(0,n.tZ)(P,{disablePortalForNotebookSelector:!0,onSelectSuccess:a})})]})};let X=f()(()=>Promise.all([l.e(3512),l.e(4288),l.e(5817)]).then(l.bind(l,55019)),{loadableGenerated:{webpack:()=>[55019]},ssr:!1}),H=f()(()=>Promise.all([l.e(3512),l.e(9153)]).then(l.bind(l,15779)),{loadableGenerated:{webpack:()=>[15779]},ssr:!1});var D=e=>{let{onOperation:t,errorMessage:l,selectedText:o,closeTooltip:a,top:i,left:s}=e,{selectedHighlightUniqueId:c,notes:h,executeNoteAction:g,updateAnnotationsSidebarType:f}=(0,r.useContext)(u.U),{modal:p}=(0,r.useContext)(d.$h),y=(e,l)=>{e.stopPropagation(),null==f||f(null),t(l)},m=h&&Object.values(h).filter(e=>e.highlight_unique_id&&e.highlight_unique_id===c),v=async e=>{await (null==g?void 0:g("CREATE",{note_content:e,highlight_unique_id:c,added_via:"TOOLBAR"}))};return(0,n.tZ)("div",{className:"absolute z-1000010 rounded-md bg-neutral-800 shadow-md",style:{top:i,left:s},"data-section":"highlight-tooltip-buttons",children:(null==m?void 0:m.length)?(0,n.tZ)(X,{notes:m,handleCopilotExplain:e=>y(e,"EXPLAIN")}):(0,n.tZ)(n.HY,{children:!c&&o?p?(0,n.tZ)(n.HY,{}):(0,n.tZ)(M,{onOperation:y,errorMessage:l,selectedText:o,closeTooltip:a}):(0,n.tZ)(H,{onSave:v})})})},U=l(91575),V=l(12410),Y=e=>{let{children:t}=e,{sendMessage:l,entityType:g,toggleCopilotSize:f}=(0,r.useContext)(s.C),{changeShowCursorText:p}=(0,r.useContext)(u.U),{selectedEntitySlugForPDFCopilotFullScreen:y}=(0,r.useContext)(h.$),{browser:m}=(0,r.useContext)(c.Tp),{showSelectionTooltip:v,setShowSelectionTooltip:b,executeHighlightAction:_,selectedHighlightUniqueId:x,highlights:E,entityType:Z}=(0,r.useContext)(u.U),{modal:C}=(0,r.useContext)(d.$h),[w,S]=(0,r.useState)(null),[N,T]=(0,r.useState)(null),[A,O]=(0,r.useState)({top:0,left:0}),P=(0,r.useRef)(null);(0,r.useEffect)(()=>{null==b||b(!1)},[C]);let L=e=>{setTimeout(()=>{var t,l;if(!(null===(l=document)||void 0===l?void 0:null===(t=l.getSelection())||void 0===t?void 0:t.toString())){if(!e.target.closest("[data-highlightable-container]")||e.target.tagName===k.VI)return;null==b||b(!1)}},0)},R=async e=>{var t,l,n,r;if(L(e),e.target.dataset.highlightTooltipEmptySpace){null==b||b(!1);return}let o=!!e.target.closest("[data-highlightable-container]"),i=!!e.target.closest('[data-section="highlight-tooltip-buttons"]');if(!o){i||null==b||b(!1);return}if(null==b||b(!1),null==_||_("UNSELECT"),(null===(l=document)||void 0===l?void 0:null===(t=l.getSelection())||void 0===t?void 0:t.toString())||e.target.tagName!==k.VI||null==_||_("SELECT",{highlight_unique_id:null===(n=e.target.dataset)||void 0===n?void 0:n.highlightId}),!(e.target instanceof HTMLElement))return;let u=!!e.target.closest("[data-highlightable]");if(e.target.closest("[data-highlightable-container]")&&u){O({top:e.pageY+("Edge"===m?10:-45),left:e.pageX+10});let t=null===(r=document)||void 0===r?void 0:r.getSelection();(null==t?void 0:t.toString().length)||e.target.tagName===k.VI||null==b||b(!1),e.target.tagName===k.VI&&(null==b||b(!0));let l=null==t?void 0:t.toString();if(!l||"\n"===l)return;(0,U.Z)("text_highlighted",{page:Z}),(0,a.setCookie)(k.TX,"true",{expires:(0,V.E4)(new Date,7)}),null==p||p(!1);let n=l.length>k.d9;null==b||b(!0),n?S("Oops! Only ".concat(k.d9," characters allowed, Try re-highlighting the desired text")):S(null),T(l)}else null==b||b(!1)},q=e=>{var t;l({message:x&&(null==E?void 0:null===(t=E[x])||void 0===t?void 0:t.selected_text)||N,message_type:"TEXT",user_prompt_type:e,selection_type:"HIGHLIGHT",attachment:null}),null==b||b(!1),T(null)},I=(0,r.useRef)(0),G=()=>{var e;let t=(null===(e=document.querySelector("[data-pdfViewer-pages-container]"))||void 0===e?void 0:e.scrollTop)||0,l=t-I.current;O({top:A.top-l,left:A.left}),I.current=t};return(0,r.useEffect)(()=>{var e;return null===(e=document.querySelector("[data-pdfViewer-pages-container]"))||void 0===e||e.addEventListener("scroll",G),()=>{var e;null===(e=document.querySelector("[data-pdfViewer-pages-container]"))||void 0===e||e.removeEventListener("scroll",G)}},[y,A]),(0,n.BX)("span",{ref:P,className:"relative",onMouseUp:R,children:[v?(0,n.tZ)(i.Z,{onClickAway:()=>null==b?void 0:b(!1),children:(0,n.tZ)(o.f,{children:(0,n.tZ)(D,{errorMessage:w,onOperation:e=>{try{q(e),f("LARGE")}catch(e){console.log("onExplain",e)}},selectedText:N,closeTooltip:()=>null==b?void 0:b(!1),...A})})}):null,t]})}},94630:function(e,t,l){l.d(t,{LK:function(){return i},aN:function(){return a},cY:function(){return r},n8:function(){return o},uC:function(){return n}});let n=(e,t)=>e.split(/(\^\[\w+\])/g).map(e=>{if(e.startsWith("^[")&&e.endsWith("]")){let l=t[e.slice(2,e.length-1)];return l?{type:"citationPreview",attrs:{citationUniqueId:l}}:{type:"text",marks:[{type:"textStyle"}],text:"(??)"}}return{type:"text",marks:[{type:"textStyle"}],text:e}}),r=e=>e?"string"==typeof e?e:Array.isArray(e)?e.map(e=>r(e)).join(""):e.text?e.text:e.content?r(e.content):"":"",o=e=>{let{link:t}=e;return'<a target="_blank" rel="noopener noreferrer nofollow" class="link" href="'.concat(t,'">(link)</a>')},a=e=>e.replaceAll("(link)",""),i=e=>e.replaceAll("\n"," ")},48728:function(e,t,l){let n=l(67294).createContext({sourceUrl:"",sourceType:null});t.Z=n},73396:function(e,t,l){l.d(t,{O:function(){return a}});var n=l(94630),r=l(5180),o=l(89588);let a=(e,t,l,a,i)=>{let u;return u=i?(0,r.vE)(i):e,l&&(u+=" ".concat((0,n.n8)({link:l}))),a&&("GLOBAL_SEARCH_COLUMN"===t||"LIBRARY_COLUMN"===t)&&(u="<h4>[".concat(a,"]</h4>").concat(u)),u="<p>"+u+"</p>",(0,o.o)(u)}},5180:function(e,t,l){l.d(t,{Kr:function(){return r},vE:function(){return n},zj:function(){return o}});let n=e=>{let t=document.getElementById(e);if(!t)return"";let l=t.querySelector("[data-markdown-renderer-content]");return l?l.innerHTML:""},r=e=>{try{return new DOMParser().parseFromString(e,"text/html").body.textContent||""}catch(e){return console.error("htmlTextToPlainText > error",e),""}},o=e=>{let t=e.parentElement;for(;t;){let e=window.getComputedStyle(t).overflowX;if("auto"===e||"scroll"===e)return t;t=t.parentElement}return null}},89588:function(e,t,l){l.d(t,{o:function(){return u}});var n=l(62082);let r=e=>{let t=e.querySelector("[data-supcitation]");if(!t)return null;let l=t.getAttribute("data-entity-fullslug"),n=t.getAttribute("data-entity-type");return l&&n?{entity_full_slug:l,entity_type:n}:null},o=e=>{let t=[];return e.forEach(e=>{let l=r(e);if(l){if(t.some(e=>e.entity_full_slug===l.entity_full_slug))return;t.push({entity_full_slug:l.entity_full_slug,entity_type:l.entity_type})}}),t},a=async e=>{try{let t=o(e);if(!t.length)return{};let{data:l}=await n.Z.getOrCreateCitation({entity_list:t}),r={};return l.forEach(e=>{var t;(null===(t=e.entity_info)||void 0===t?void 0:t.full_slug)&&(r[e.entity_info.full_slug]=e.unique_id)}),r}catch(e){return console.log("getOrCreateCitations",e),{}}},i=e=>{o(e.querySelectorAll('[data-state="closed"]')).forEach(t=>{let l=e.querySelectorAll('[data-entity-fullslug="'.concat(t.entity_full_slug,'"]'));l.length<=1||l.forEach((e,t)=>{var l;0!==t&&(null===(l=e.parentNode)||void 0===l||l.removeChild(e))})})},u=async e=>{let t=new DOMParser().parseFromString(e,"text/html"),l=t.querySelectorAll('[data-state="closed"]');l.forEach(e=>{e.parentNode&&i(e.parentNode)}),l=t.querySelectorAll('[data-state="closed"]');let n=await a(l);return l.forEach(e=>{if(!e.parentNode)return;let t=r(e),l=(null==t?void 0:t.entity_full_slug)?n[t.entity_full_slug]:null;if((null==t?void 0:t.entity_full_slug)&&l){let t=document.createElement("span");t.className="node-citationPreview",t.setAttribute("citationuniqueid",l),e.parentNode.appendChild(t)}e.parentNode.removeChild(e)}),t.body.innerHTML}}}]);