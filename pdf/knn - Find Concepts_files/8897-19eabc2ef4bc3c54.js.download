"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8897],{24522:function(t,e,a){a.d(e,{BQ:function(){return i},D:function(){return l}});let l=t=>{var e,a;return(null==t?void 0:null===(e=t.status)||void 0===e?void 0:e.frames)==="PENDING"||(null==t?void 0:null===(a=t.status)||void 0===a?void 0:a.video)==="PENDING"},i=t=>{var e,a;return(null==t?void 0:null===(e=t.status)||void 0===e?void 0:e.frames)==="SUCCESS"&&(null==t?void 0:null===(a=t.status)||void 0===a?void 0:a.video)===null}},88864:function(t,e,a){var l=a(67294),i=a(91444),r=a(90717);let n={title:"",full_slug:"",is_published:!1,created_at:"",updated_at:"",status:"PENDING"};e.Z=t=>{let{initialSlide:e,paperSlug:a,onSlidesGenerationStarted:s,onSlidesPublished:u,payloadConfig:o}=t,[c,d]=(0,l.useState)(e),g=(0,l.useRef)(null),f=async()=>{d({...n});try{let l=null==e?void 0:e.full_slug;if(!l){var t;let e=null===(t=(await r.Z.getPaperSlideData(a)).data)||void 0===t?void 0:t[0];if((null==e?void 0:e.full_slug)||(e=await r.Z.createSlidesEntry(a)),!(l=null==e?void 0:e.full_slug))return;await r.Z.triggerSlidesGeneration(l),null==s||s()}v(l)}catch(t){console.log("handleLoadAssets",t),i.Am.error("Something went wrong while fetching slides. Try refreshing")}},v=async t=>{try{let e=await r.Z.getSlidesMetaData({slug:t,config:o});if("SUCCESS"===e.status){h(e);return}"PENDING"===e.status&&(g.current=setTimeout(()=>{v(t)},1e4)),d(e)}catch(t){console.log("fetchSldiesDataRecursively",t),i.Am.error("Something went wrong while fetching slides. Try refreshing")}},m=async()=>{if(c){d({...c,status:"PENDING"});try{await r.Z.triggerSlidesGeneration(c.full_slug),g.current=setTimeout(()=>{v(c.full_slug)},1e4)}catch(t){console.log("retry slides",t),i.Am.error("Something went wrong while fetching assets. Try refreshing"),d({...c,status:"FAILURE"})}}},h=async t=>{d({...await r.Z.publishSlidesData(t.full_slug),thumbnail:null==t?void 0:t.thumbnail,is_published:!0}),null==u||u()};return(0,l.useEffect)(()=>{if((null==c?void 0:c.status)==="PENDING"){v(null==c?void 0:c.full_slug);return}return(null==c?void 0:c.status)!=="SUCCESS"||c.is_published||h(c),()=>{g.current&&clearTimeout(g.current)}},[a]),{slideMetaData:c,retrySlideGeneration:m,generateSlides:f}}},36949:function(t,e,a){a.d(e,{Z:function(){return w}});var l=a(67294),i=a(91444),r=a(24522),n=a(90717),s=a(35944),u=a(23473),o=a(13458),c=a(24737),d=a(49876),g=a(66054),f=a(64749),v=a(36646),m=(t,e)=>{let[a,i]=(0,l.useState)(null),r=(0,l.useRef)(null),m=async(a,l)=>{let m=await n.Z.getVideoData(a);if(!m.data)return;let h=m.data.default.content.map(t=>{var e;return null===(e=t.content)||void 0===e?void 0:e[0]}).map((t,e)=>{var a;return t?(0,s.BX)("div",{className:"relative",style:{width:c.Kf,height:c.cJ},"data-id":(null===(a=t.attrs)||void 0===a?void 0:a.unique_id)||e,"data-frame":!0,children:[(0,s.tZ)(u.default,{editorData:{type:"doc",content:[t]},scaleConfig:{scaleFactor:1,elementOriginalHeight:c.cJ,elementOriginalWidth:c.Kf},variant:"VIDEO"}),(0,s.tZ)(o.Z,{className:"absolute right-2 top-2 w-20"})]},e):(0,s.tZ)("div",{},e)});i((0,s.tZ)("div",{className:"fixed",style:{left:"150vw"},children:h})),r.current=setTimeout(async()=>{let i=await (0,f.nP)(t,e,{width:1080,height:1920});i.map(t=>console.log(URL.createObjectURL(t)));let r=i.map(t=>t.name),s=await d.Z.getVideosFrameImageUploadSignedUrl({frames_unique_id:m.unique_id,files:r}),u=await i.map(async(t,e)=>{let a=s.data[e];await (0,v.O)(t,a)});await Promise.all(u);let o=null,c=await g.Z.getUserAvatar();if(c.unique_id)o=c.unique_id;else{let t=(await g.Z.getDefaultUserAvatars()).data.find(t=>"MALE"===t.category);o=null==t?void 0:t.unique_id}o&&(await n.Z.triggerVideoGeneration(a,o),l())},4e3)};return(0,l.useEffect)(()=>()=>{r.current&&clearTimeout(r.current)},[]),{renderedFrames:a,handleGenerateVideo:m}};let h={title:"",full_slug:"",is_published:!1,created_at:"",updated_at:""};var w=t=>{let{paperSlug:e,initialVideo:a,onVideoGenerationStarted:s,onVideoPublished:u,payloadConfig:o}=t,[c,d]=(0,l.useState)(a),g=(0,l.useRef)(null),{renderedFrames:f,handleGenerateVideo:v}=m("[data-frame]","data-id"),w=async()=>{d({...h,status:{frames:"PENDING",video:null}});try{let l=null==a?void 0:a.full_slug;if(!l){var t;let a=null===(t=(await n.Z.getPaperVideoData(e)).data)||void 0===t?void 0:t[0];(null==a?void 0:a.full_slug)||(a=await n.Z.createVideoEntry(e)),l=null==a?void 0:a.full_slug}l&&(await n.Z.triggerFramesGeneration(l),null==s||s(),_(l))}catch(t){console.log("handleLoadAssets",t),i.Am.error("Something went wrong while fetching assets. Try refreshing"),d({...h,status:{frames:"PENDING",video:null}})}},y=async t=>{await v(t.full_slug,()=>{g.current=setTimeout(()=>{_(t.full_slug)},1e4)})},_=async t=>{try{var e;let a=await n.Z.getVideosMetaData({slug:t,config:o});if(d(a),(0,r.D)(a)){g.current=setTimeout(()=>{_(t)},1e4);return}(0,r.BQ)(a)?await y(a):(null===(e=a.status)||void 0===e?void 0:e.video)==="SUCCESS"&&(null==u||u())}catch(t){console.log("fetchVideoDataRecursively",t),i.Am.error("Something went wrong while fetching video. Try refreshing")}},S=async()=>{var t,e;if(c){if((null===(t=c.status)||void 0===t?void 0:t.frames)==="FAILURE"){d({...c,status:{...c.status,frames:"PENDING"}});try{await n.Z.triggerFramesGeneration(c.full_slug),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{_(c.full_slug)},1e4)}catch(t){console.log("retry video > triggerFramesGeneration",t),i.Am.error("Something went wrong while fetching assets. Try refreshing"),d({...c,status:{...c.status,frames:"FAILURE"}})}}else if((null===(e=c.status)||void 0===e?void 0:e.video)==="FAILURE"){d({...c,status:{...c.status,video:"PENDING"}});try{await v(c.full_slug,()=>{g.current=setTimeout(()=>{_(c.full_slug)},1e4)})}catch(t){console.log("retry video > handleGenerateVideo",t),i.Am.error("Something went wrong while fetching assets. Try refreshing"),d({...c,status:{...c.status,video:"FAILURE"}})}}}};return(0,l.useEffect)(()=>{var t,e,a;if((null==c?void 0:null===(t=c.status)||void 0===t?void 0:t.frames)==="PENDING"||(null==c?void 0:null===(e=c.status)||void 0===e?void 0:e.video)==="PENDING"){_(null==c?void 0:c.full_slug);return}return(0,r.BQ)(c)&&(d({...h,status:{frames:"SUCCESS",video:"PENDING"}}),c&&y(c)),(null==c?void 0:c.full_slug)&&!(null===(a=c.status)||void 0===a?void 0:a.frames)&&y(c),()=>{g.current&&clearTimeout(g.current)}},[e]),{videoMetaData:c,retryVideoGeneration:S,generateVideo:w,renderedFrames:f}}},90717:function(t,e,a){var l=a(9669),i=a.n(l),r=a(65829);let n="/api/papers",s=t=>{let e=t.split("-");return e[e.length-2],n};class u{async createSlidesEntry(t){let e="".concat(n,"/").concat(t,"/slides");return(await i().post(e)).data}async getPaperSlideData(t){let e="".concat(n,"/").concat(t,"/slides");return(await i().get(e)).data}async triggerSlidesGeneration(t){let e=s(t),a="".concat(e,"/slides/").concat(t,"/document");return(await i().post(a)).data}async getSlidesMetaData(t){let e=s(t.slug),a="".concat(e,"/slides/").concat(t.slug),l=(0,r.tK)(t.config);return(await i().get(a,{params:l})).data}async getSlidesData(t){let e=s(t),a="".concat(e,"/slides/").concat(t,"/document");return(await i().get(a)).data}async publishSlidesData(t){let e=s(t),a="".concat(e,"/slides/").concat(t);return(await i().patch(a,{is_published:!0})).data}async createVideoEntry(t){let e="".concat(n,"/").concat(t,"/videos");return(await i().post(e)).data}async getPaperVideoData(t){let e="".concat(n,"/").concat(t,"/videos");return(await i().get(e)).data}async triggerFramesGeneration(t){let e=s(t),a="".concat(e,"/videos/").concat(t,"/frames");return(await i().post(a)).data}async getVideosMetaData(t){let e=s(t.slug),a="".concat(e,"/videos/").concat(t.slug),l=(0,r.tK)(t.config);return(await i().get(a,{params:l})).data}async getVideoData(t){let e=s(t),a="".concat(e,"/videos/").concat(t,"/frames");return(await i().get(a)).data}async triggerVideoGeneration(t,e){let a=s(t),l="".concat(a,"/videos/").concat(t,"/generate");return(await i().post(l,{user_avatar_unique_id:e})).data}async getPaperPdfSummaryData(t){let e="".concat(n,"/").concat(t,"/pdf-summary");return(await i().get(e)).data}constructor(){this.createPaperPdfSummaryData=async t=>{let e="".concat(n,"/").concat(t,"/pdf-summary");return(await i().post(e)).data}}}let o=new u;e.Z=o}}]);